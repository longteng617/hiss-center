import{_ as Ca,d as Ba,u as Ta,r as f,o as Oa,c as Ia,a as r,b as s,e as p,t as K,f as d,g as L,w as b,h as N,i as La,M as Na,F as k,j as A,k as Sa,v as Ra,l as i,n as S,m as Ua}from"../build.js";import{f as B,A as za,s as Ma}from"./Amap.9df1a253.js";const Ha={class:"renderFormCont"},Ga={key:0,class:"title"},ja={key:1,class:"formCont"},Ja={key:13,class:"position"},Za={key:14,class:"subformItem"},Ka=["onClick"],qa={key:2,class:"fx",style:{"margin-top":"20px"}},Pa=Ba({__name:"renderForm",props:{preview:String},setup(q){const R=q,P=Ta(),X=u=>{const a={before:u.data.minValue,after:u.data.maxValue};for(const t in a)a[t]||(a[t]=void 0);return JSON.parse(JSON.stringify(a))},Y=u=>{const a={before:u.data.dateType==="week"?u.data.disableDaySt:u.data.minValue,after:u.data.dateType==="week"?u.data.disableDayLt:u.data.maxValue};for(const t in a)a[t]||(a[t]=void 0);return JSON.parse(JSON.stringify(a))},$=f(),g=f(),E=f(),F=f("preview"),U=f(""),m=f(""),c=f(),z=La(),T=f("");Oa(()=>{R.preview&&(F.value="preview");const u=z.appContext.app;if(console.log("\u914D\u7F6E\u53C2\u6570::",u.$initConfig),u.$initConfig){const{type:a,baseData:t,uploadUrl:o}=u.$initConfig;U.value=t.formId,m.value=t.dataId,T.value=o,c.value=t,R.preview?F.value="preview":a&&(F.value=a)}Q()});const M=u=>{console.log("\u56FE\u7247\u4E0A\u4F20\u6210\u529F",u)},Q=()=>{if(F.value==="preview"){const u=P.getSubmitFormData.palyload;u&&Object.keys(u.formDetail.formData[0].data).length>0&&($.value=u.formDetail.baseFormData,g.value=u.formDetail.formData[0].data,O())}else ta(),ha()},x=f(),W=u=>{x.value=u},aa=(u,a)=>{!u||(x.value.data.maxLength!==void 0&&Number(x.value.data.maxLength)>1&&a.trigger==="check"?ea(u,{current:a.option.value}):l.value[`${x.value.id}`]=u)},ea=(u,a)=>{const t=x.value;if(t.data.excludeOptions&&t.data.excludeOptions.length>0){const o=t.data.excludeOptions.indexOf(a.current),v=l.value[`${t.id}`].indexOf(a.current);if(Array.isArray(l.value[`${t.id}`])&&l.value[`${t.id}`].length===1&&t.data.excludeOptions.indexOf(l.value[`${t.id}`][0])!==-1){l.value[`${t.id}`]=[a.current];return}o===-1&&v===-1?Array.isArray(l.value[`${t.id}`])&&l.value[`${t.id}`].length===0?l.value[`${t.id}`]=[a.current]:l.value[`${t.id}`].push(a.current):o!==-1&&v!==-1?l.value[`${t.id}`]=[]:o!==-1&&v===-1&&(l.value[`${t.id}`]=[a.current])}else l.value[`${t.id}`]=u},ta=async()=>{const u=U.value;await B({id:"GET_MY_FORM",messageAuth:{tenant:"tenant_hiss",currentUser:{userId:"1",userName:"\u5F20\u4E09",userGroups:""}},palyload:{ids:u,query:""}}).then(t=>{const o=t.data.res,v=JSON.parse(o[0].context);$.value=v.baseFormData;const y=v.formData[0].data;if(Object.keys(c.value).length>0){const{fields:h}=c.value.formConfig;for(const D in y)for(const w in h)String(y[D].id)===String(h[w].fieldName)&&(y[D].data.tripartiteType=h[w].type)}g.value=y})},l=f({}),H=f(),ua=u=>{H.value=u},la=(u,a)=>{const t=H.value;Array.isArray(l.value[`${t.id}`])||(l.value[`${t.id}`]=[]);const o=l.value[`${t.id}`],v=Array.isArray(o)?o.indexOf(a.current):-1;if(v!==-1){l.value[`${t.id}`].splice(v,1);return}if(t.data.excludeOptions&&t.data.excludeOptions.length>0){const y=t.data.excludeOptions.indexOf(a.current),h=o.indexOf(a.current);if(Array.isArray(o)&&o.length===1&&t.data.excludeOptions.indexOf(o[0])!==-1){l.value[`${t.id}`]=[a.current];return}y===-1&&h===-1?Array.isArray(o)&&o.length===0?l.value[`${t.id}`]=[a.current]:l.value[`${t.id}`].push(a.current):y!==-1&&h!==-1?l.value[`${t.id}`]=[]:y!==-1&&h===-1&&(l.value[`${t.id}`]=[a.current])}else l.value[`${t.id}`]=u},da=Ia(()=>{const u={};return g.value&&Object.keys(g.value).length!==0&&g.value.forEach(a=>{if(a.data.isMust&&(u[`${a.id}`]=[{required:!0,message:a.data.placeholder,type:"error",trigger:"blur"}]),a.type==="input"){const t=a.data.inputType!=="none"?va(a.data.inputType):null,o={validator:t,message:a.data.errorPrompt||"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u503C"};t&&u[`${a.id}`]!==void 0?u[`${a.id}`].push(o):t&&u[`${a.id}`]===void 0&&(u[`${a.id}`]=[o]),a.data.minLength&&u[`${a.id}`]!==void 0?u[`${a.id}`].push({min:Number(a.data.minLength),message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u957F\u5EA6"}):a.data.minLength&&u[`${a.id}`]===void 0&&(u[`${a.id}`]=[{min:Number(a.data.minLength),message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u957F\u5EA6"}]),a.data.maxLength&&u[`${a.id}`]!==void 0?u[`${a.id}`].push({max:Number(a.data.maxLength),message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u957F\u5EA6"}):a.data.maxLength&&u[`${a.id}`]===void 0&&(u[`${a.id}`]=[{max:Number(a.data.maxLength),message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u957F\u5EA6"}])}(a.type==="checkbox"||a.type==="select"&&a.data.maxLength&&a.data.maxLength>1)&&(a.data.minLength&&u[`${a.id}`]!==void 0?u[`${a.id}`].push({validator:t=>t.length>=a.data.minLength,message:`\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9009\u9879, \u6700\u5C11\u5E94\u9009${a.data.minLength}\u4E2A`}):a.data.minLength&&u[`${a.id}`]===void 0&&(u[`${a.id}`]=[{validator:t=>t.length>=a.data.minLength,message:`\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9009\u9879, \u6700\u5C11\u5E94\u9009${a.data.minLength}\u4E2A`}]),a.data.maxLength&&u[`${a.id}`]!==void 0?u[`${a.id}`].push({validator:t=>(console.log(t,t.length),t.length<=a.data.maxLength),message:`\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9009\u9879, \u6700\u591A\u5E94\u9009${a.data.maxLength}\u4E2A`}):a.data.maxLength&&u[`${a.id}`]===void 0&&(u[`${a.id}`]=[{validator:t=>(console.log(t,t.length),t.length<=a.data.maxLength),message:`\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9009\u9879, \u6700\u591A\u5E94\u9009${a.data.maxLength}\u4E2A`}])),a.type==="number"&&a.data.floatNum&&u[`${a.id}`]!==void 0&&u[`${a.id}`].push({validator:t=>String(t).split(".").length>=2?String(t).split(".")[1].length<=a.data.floatNum:!0,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u957F\u5EA6"}),a.type==="number"&&a.data.floatNum&&u[`${a.id}`]===void 0&&(u[`${a.id}`]=[{validator:t=>String(t).split(".").length>=2?String(t).split(".")[1].length<=a.data.floatNum:!0,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u957F\u5EA6"}])}),console.log("\u6548\u9A8C\u89C4\u5219\uFF1A",u),u}),na=/^-?\d+(\.\d+)?$/,sa=/^-?\d+$/,oa=/^-?(?!0)\d+(\.\d+)?$/,ra=/^(?:https?:\/\/)?(?:www\.)?[a-zA-Z0-9-]+\.[a-zA-Z]{2,}(?:\/[\w-]*)*\/?$/,ia=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,ca=/^1[3|4|5|6|7|8|9]\\d{9}$/,pa=/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,fa=/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,va=u=>{let a=null;switch(u){case"number":a=t=>na.test(t);break;case"int":a=t=>sa.test(t);break;case"float":a=t=>oa.test(t);break;case"url":a=t=>ra.test(t);break;case"emil":a=t=>ia.test(t);break;case"phone":a=t=>ca.test(t);break;case"idNumber":a=t=>pa.test(t)||fa.test(t);break}return a},ya=u=>{l.value[`${u.item.id}`]=u.data},O=u=>{let a={};g.value&&g.value.forEach(t=>{(t.type==="checkbox"||t.type==="dateArea")&&(a[`${t.id}`]=[]),t.data.defaultValue!==""&&t.data.defaultValue!==void 0&&(a[`${t.id}`]=t.data.defaultValue)}),u&&(a={...a,...u}),l.value=a},G=async()=>{if(E.value.validate()){const a={id:"SUBMIT_FORM_DATA",messageAuth:{tenant:"tenant_hiss",currentUser:{userId:"1",userName:"\u5F20\u4E09",userGroups:""}},palyload:{modelId:c.value.modelId,formId:c.value.formId,dataId:c.value.dataId||m.value,draft:!0,formConfig:c.value.formConfig,formData:[{page:1,data:{...l.value}}]}},t=await B(a);return m.value=t.data.result,t}},I=async()=>{const u=E.value;if(console.log("\u6570\u636E\u63D0\u4EA4\u53C2\u6570111\uFF1A",{...l.value}),u.validate()){const a={id:"SUBMIT_FORM_DATA",messageAuth:{tenant:"tenant_hiss",currentUser:{userId:"1",userName:"\u5F20\u4E09",userGroups:""}},palyload:{modelId:c.value.modelId,formId:c.value.formId,dataId:c.value.dataId||m.value,formConfig:c.value.formConfig,draft:!1,formData:[{page:1,data:{...l.value}}]}},t=await B(a);return m.value=t.data.result,t}},ha=()=>{if(E.value.validate()){const a={id:"GET_MY_FORM_DATA",messageAuth:{tenant:"tenant_hiss",currentUser:{userId:"1",userName:"\u5F20\u4E09",userGroups:""}},palyload:{modelId:c.value.modelId,formId:c.value.formId,dataId:c.value.dataId||m.value}};if(!a.palyload.dataId)return;B(a).then(t=>{t.code===200&&t.data.result&&Object.keys(t.data.result).length>0?O(t.data.result):O()})}},V=f([0]),j=u=>{u?V.value.splice(u,1):V.value.push(V.value.at(-1)+1)},_=f([]),ga=u=>{if(_.value.length===0)_.value.push(u);else{const a=_.value.findIndex(t=>t.datakey===u.datakey);a===-1?_.value.push(u):_.value.splice(a,1,u)}l.value[`${u.id}`]=ma(_.value)},ma=u=>{let a=[];return u&&Array.isArray(u)&&(a=u.map(t=>t.data)),a},J=z.appContext.app;J.submitFn=I,J.submitCatchFn=G;const _a=()=>{Na.success("\u91CD\u7F6E\u6210\u529F")};return(u,a)=>{const t=r("t-input"),o=r("t-textarea"),v=r("t-radio"),y=r("t-radio-group"),h=r("t-checkbox"),D=r("t-checkbox-group"),w=r("t-option"),ba=r("t-select"),$a=r("t-switch"),Fa=r("t-rate"),xa=r("t-slider"),ka=r("t-date-picker"),Aa=r("t-date-range-picker"),Ea=r("t-input-number"),Z=r("t-upload"),Va=r("t-form-item"),Da=r("t-form");return s(),p("div",Ha,[$.value&&$.value.formTitle?(s(),p("div",Ga,K($.value.formTitle||""),1)):d("v-if",!0),l.value?(s(),p("div",ja,[L(Da,{ref_key:"formValidatorStatus",ref:E,data:l.value,rules:da.value,"label-width":100,width:"100%",style:{width:"100%",display:"flex","flex-wrap":"wrap"},onReset:_a,onSubmit:I},{default:b(()=>[(s(!0),p(k,null,A(g.value,e=>Sa((s(),i(Va,{key:e.id,"label-width":e.data.isShowTitle?`${e.data.title.length<=6?120:e.data.title.length*20} px`:e.data.isMust?"10px":0,label:e.data.isShowTitle?`${e.data.title}\uFF1A`:"",name:`${e.id}`,style:S({width:`${e.data.width?e.data.width:100}%`})},{default:b(()=>[e.type==="input"?(s(),i(t,{key:0,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,placeholder:e.placeholder,showLimitNumber:e.data.isStatistics,defaultValue:e.defaultValue,maxlength:Number(e.data.maxLength),minlength:Number(e.data.minLength),disabled:e.data.isReadOnly||e.data.tripartiteType==="view"},null,8,["modelValue","onUpdate:modelValue","placeholder","showLimitNumber","defaultValue","maxlength","minlength","disabled"])):d("v-if",!0),d(" \u591A\u884C\u6587\u672C "),e.type==="textArea"?(s(),i(o,{key:1,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,placeholder:e.placeholder,maxcharacter:Number(e.data.maxLength),showLimitNumber:e.data.isStatistics,disabled:e.data.isReadOnly||e.data.tripartiteType==="view"},null,8,["modelValue","onUpdate:modelValue","placeholder","maxcharacter","showLimitNumber","disabled"])):d("v-if",!0),d(" \u5355\u9009 "),e.type==="radio"?(s(),i(y,{key:2,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,defaultValue:e.data.defaultValue,style:S({display:"flex","flex-direction":e.data.direction,"align-items":"flex-start"}),disabled:e.data.isReadOnly||e.data.tripartiteType==="view"},{default:b(()=>[(s(!0),p(k,null,A(e.data.titlab,n=>(s(),i(v,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","defaultValue","style","disabled"])):d("v-if",!0),d(" \u591A\u9009 "),e.type==="checkbox"?(s(),i(D,{key:3,value:l.value[`${e.id}`]||[],defaultValue:e.data.defaultValue||[],style:S({display:"flex","flex-direction":e.data.direction}),max:Number(e.data.maxLength)||1/0,disabled:e.data.isReadOnly||e.data.tripartiteType==="view",onChange:la,onClick:n=>ua(e)},{default:b(()=>[(s(!0),p(k,null,A(e.data.titlab,(n,C)=>(s(),i(h,{key:C,label:n,value:n},null,8,["label","value"]))),128))]),_:2},1032,["value","defaultValue","style","max","disabled","onClick"])):d("v-if",!0),d(" \u4E0B\u62C9\u6846 "),e.type==="select"?(s(),i(ba,{key:4,value:l.value[`${e.id}`],placeholder:"\u8BF7\u9009\u62E9",multiple:e.data.maxLength>1,max:Number(e.data.maxLength)||100,size:"small",class:"selectCont",disabled:e.data.isReadOnly||e.data.tripartiteType==="view",onClick:n=>W(e),onChange:aa},{default:b(()=>[(s(!0),p(k,null,A(e.data.titlab,n=>(s(),i(w,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:2},1032,["value","multiple","max","disabled","onClick"])):d("v-if",!0),d(" \u5F00\u5173 "),e.type==="switch"?(s(),i($a,{key:5,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,disabled:e.data.isReadOnly||e.data.tripartiteType==="view"},null,8,["modelValue","onUpdate:modelValue","disabled"])):d("v-if",!0),d(" \u8BC4\u5206 "),e.type==="rate"?(s(),i(Fa,{key:6,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,disabled:e.data.isReadOnly||e.data.tripartiteType==="view",allowHalf:"",size:"20px"},null,8,["modelValue","onUpdate:modelValue","disabled"])):d("v-if",!0),d(" \u6ED1\u5757 "),e.type==="slider"?(s(),i(xa,{key:7,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,max:e.data.maxValue,min:e.data.minValue,step:e.data.step,disabled:e.data.isReadOnly||e.data.tripartiteType==="view",size:"small"},null,8,["modelValue","onUpdate:modelValue","max","min","step","disabled"])):d("v-if",!0),d(" \u65E5\u671F\u9009\u62E9\u5668 "),e.type==="timeSelect"?(s(),i(ka,{key:8,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,mode:e.data.dateType&&e.data.dateType!=="dateTime"?e.data.dateType:"date",disabled:e.data.isReadOnly||e.data.tripartiteType==="view",disableDate:X(e),clearable:"","enable-time-picker":e.data.dateType==="dateTime"},null,8,["modelValue","onUpdate:modelValue","mode","disabled","disableDate","enable-time-picker"])):d("v-if",!0),d(" \u65E5\u671F\u533A\u95F4 "),e.type==="dateArea"?(s(),i(Aa,{key:9,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,clearable:"",size:"small",mode:e.data.dateType&&e.data.dateType!=="dateTime"?e.data.dateType:"date",disabled:e.data.isReadOnly||e.data.tripartiteType==="view",disableDate:Y(e),"enable-time-picker":e.data.dateType==="dateTime"},null,8,["modelValue","onUpdate:modelValue","mode","disabled","disableDate","enable-time-picker"])):d("v-if",!0),d(" \u6570\u5B57\u8F93\u5165\u6846 "),e.type==="number"?(s(),i(Ea,{key:10,modelValue:l.value[`${e.id}`],"onUpdate:modelValue":n=>l.value[`${e.id}`]=n,max:e.data.maxValue||1/0,min:e.data.minValue||-1/0,disabled:e.data.isReadOnly||e.data.tripartiteType==="view",placeholder:"\u8BF7\u8F93\u5165\u9ED8\u8BA4\u503C"},{label:b(()=>[N("span",null,K(e.data.prefix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","max","min","disabled"])):d("v-if",!0),d(" \u9644\u4EF6 "),e.type==="file"?(s(),i(Z,{key:11,action:T.value,size:"small","size-limit":{size:e.data.fileSize||1024*10,unit:"KB"},max:e.data.maxFileNum||99,disabled:e.data.isReadOnly||e.data.tripartiteType==="view",onSuccess:M},null,8,["action","size-limit","max","disabled"])):d("v-if",!0),d(" \u56FE\u7247 "),e.type==="img"?(s(),i(Z,{key:12,action:T.value,size:"small",theme:"image","size-limit":{size:e.data.fileSize||1024*10,unit:"KB"},max:e.data.maxFileNum||99,disabled:e.data.isReadOnly||e.data.tripartiteType==="view",onSuccess:M},null,8,["action","size-limit","max","disabled"])):d("v-if",!0),d(" \u4F4D\u7F6E "),e.type==="position"?(s(),p("div",Ja,[L(za,{data:e,onValueChange:ya},null,8,["data"])])):d("v-if",!0),d("-\u5B50\u8868\u5355"),d(" TODO \u5B50\u8868\u8FD9\u5757\u6548\u9A8C\u5148\u653E\u4E00\u653E \u76EE\u524D\u7684\u6548\u9A8C\u662F\u5199\u5230form\u91CC\u7684 \u6548\u9A8C\u5B57\u6BB5\u662Fid \u4F46\u5B50\u8868id \u662F\u91CD\u590D\u65E0\u6CD5\u4F5C\u4E3A\u6548\u9A8C\u7684key"),e.type==="subform"&&e.data.formData.length!=0?(s(),p("div",Za,[(s(!0),p(k,null,A(V.value,(n,C)=>(s(),p("div",{key:n,class:Ua({item:!0,fx:e.data.formData.length<=5})},[C===0?(s(),p("span",{key:0,class:"add",onClick:a[0]||(a[0]=wa=>j())},"+")):(s(),p("span",{key:1,class:"red",onClick:wa=>j(C)},"-",8,Ka)),L(Ma,{id:e.id,dataKey:n,fromDataes:e.data.formData,initData:l.value[`${e.id}`],onValueChange:ga},null,8,["id","dataKey","fromDataes","initData"])],2))),128))])):d("v-if",!0),d(" \u7701\u5E02\u533A "),d(" \u5206\u5272\u7EBF "),d(" \u6309\u94AE "),d(" \u90E8\u95E8 "),d(" \u4EBA\u5458 ")]),_:2},1032,["label-width","label","name","style"])),[[Ra,!(e.data.isShow||!e.data.isShow&&e.data.tripartiteType==="hide")]])),128))]),_:1},8,["data","rules"])])):d("v-if",!0),d(` <div v-eles>\r
      \u8868\u5355\u751F\u6210\u4E2D...\r
    </div> `),F.value==="preview"?(s(),p("div",qa,[N("div",{class:"bt",style:{margin:"20px",width:"100px"},onClick:I}," \u6570\u636E\u63D0\u4EA4 "),N("div",{class:"bt",style:{margin:"20px",width:"100px"},onClick:G}," \u6570\u636E\u6682\u5B58 ")])):d("v-if",!0)])}}});var Qa=Ca(Pa,[["__scopeId","data-v-3dde235e"],["__file","E:/\u6559\u7814\u8D44\u6599/activiti/codespace/hiss/process-form-ui/src/pages/form/renderForm.vue"]]);export{Qa as default};
